<div class="dashboard-container">
  <!-- Date filter container -->
  <mat-card class="date-filter-card">
    <form [formGroup]="dateRangeForm" class="date-filter-form">
      <mat-form-field appearance="outline" class="date-field">
        <mat-label>Date de début</mat-label>
        <input matInput [matDatepicker]="startDatePicker" formControlName="start">
        <mat-datepicker-toggle matIconSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="outline" class="date-field">
        <mat-label>Date de fin</mat-label>
        <input matInput [matDatepicker]="endDatePicker" formControlName="end">
        <mat-datepicker-toggle matIconSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
      </mat-form-field>
      <div class="date-buttons">
        <button mat-raised-button color="primary" (click)="applyDateFilter()">Appliquer</button>
        <button mat-stroked-button color="basic" (click)="resetDateFilter()">Réinitialiser</button>
      </div>
    </form>
  </mat-card>

  <!-- Stats grid -->
  <mat-grid-list cols="4" rowHeight="100px" gutterSize="16px">
    <mat-grid-tile>
      <mat-card class="stat-card">
        <mat-card-header class="stat-header">
          <mat-icon>groups</mat-icon>
          <mat-card-title>Total groupes</mat-card-title>
        </mat-card-header>
        <mat-card-content class="stat-content">
          <h2>{{ stats.totalGroups || 0 }}</h2>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-card class="stat-card">
        <mat-card-header class="stat-header">
          <mat-icon>person</mat-icon>
          <mat-card-title>Total utilisateurs</mat-card-title>
        </mat-card-header>
        <mat-card-content class="stat-content">
          <h2>{{ stats.totalUsers || 0 }}</h2>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-card class="stat-card">
        <mat-card-header class="stat-header">
          <mat-icon>attach_money</mat-icon>
          <mat-card-title>Contributions totales</mat-card-title>
        </mat-card-header>
        <mat-card-content class="stat-content">
          <h2>{{ stats.totalContributions | currencyXAF }}</h2>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-card class="stat-card">
        <mat-card-header class="stat-header">
          <mat-icon>sports_soccer</mat-icon>
          <mat-card-title>Total matchs</mat-card-title>
        </mat-card-header>
        <mat-card-content class="stat-content">
          <h2>{{ stats.totalMatches || 0 }}</h2>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-card class="stat-card">
        <mat-card-header class="stat-header paid-sanctions">
          <mat-icon>check_circle</mat-icon>
          <mat-card-title>Sanctions payées</mat-card-title>
        </mat-card-header>
        <mat-card-content class="stat-content">
          <h2>{{ stats.paidSanctions?.amount | currencyXAF }}</h2>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-card class="stat-card">
        <mat-card-header class="stat-header unpaid-sanctions">
          <mat-icon>warning</mat-icon>
          <mat-card-title>Sanctions non payées</mat-card-title>
        </mat-card-header>
        <mat-card-content class="stat-content">
          <h2>{{ stats.unpaidSanctions?.amount | currencyXAF }}</h2>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>
  </mat-grid-list>

  <!-- Charts grid -->
  <div class="charts-grid">
    <mat-card class="chart-card">
      <mat-card-header class="chart-header">
        <mat-card-title>Répartition des rôles</mat-card-title>
      </mat-card-header>
      <mat-card-content class="chart-content">
        <canvas baseChart [data]="donutChartData" [type]="donutChartType" [options]="donutChartOptions"></canvas>
      </mat-card-content>
    </mat-card>

    <mat-card class="chart-card">
      <mat-card-header class="chart-header">
        <mat-card-title>Contributions par groupe</mat-card-title>
      </mat-card-header>
      <mat-card-content class="chart-content">
        <canvas baseChart [data]="barChartData" [type]="barChartType" [options]="barChartOptions"></canvas>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Users table and recent activity list -->
  <div class="table-and-list-grid">
    <mat-card class="users-table-card">
      <mat-card-header class="users-table-header">
        <mat-card-title>Utilisateurs par groupe</mat-card-title>
        <mat-form-field appearance="fill" class="group-select">
          <mat-label>Sélectionner un groupe</mat-label>
          <mat-select [value]="selectedGroup" (selectionChange)="selectGroup($event.value)">
            <mat-option *ngFor="let group of stats.usersByGroup" [value]="group">
              {{ group.groupName }} ({{ group.userCount }})
            </mat-option>
          </mat-select>
        </mat-form-field>
      </mat-card-header>
      <mat-card-content class="table-content">
        <table mat-table [dataSource]="selectedGroup?.users">
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> ID </th>
            <td mat-cell *matCellDef="let user"> {{ user.id }} </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Nom </th>
            <td mat-cell *matCellDef="let user"> {{ user.name }} </td>
          </ng-container>

          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef> Rôle </th>
            <td mat-cell *matCellDef="let user"> {{ user.role }} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>

    <mat-card class="activity-list-card">
      <mat-card-header class="activity-header">
        <mat-card-title>Activité récente</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-list>
          <mat-list-item *ngFor="let activity of stats.recentActivity">
            <mat-icon matListItemAvatar>history</mat-icon>
            <div matListItemTitle>{{ activity.date | date: 'mediumDate' }}</div>
            <div matListItemLine>{{ activity.action }}</div>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>
</div>
