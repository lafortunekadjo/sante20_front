<div class="evenement-container">
  <h1 class="page-title">Gestion des Événements</h1>

  <mat-card class="table-card">
    <mat-card-header class="card-header">
      <div>
        <mat-card-title class="card-title">Liste des Événements</mat-card-title>
        <mat-card-subtitle class="card-subtitle">
          Ajoutez ou modifiez les événements ci-dessous
        </mat-card-subtitle>
      </div>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p class="loading-text">Chargement des données...</p>
      </div>

      <div *ngIf="!isLoading" class="content-wrapper">
        <div class="filter-row">
          <button
            mat-raised-button
            color="primary"
            (click)="toggleCreateRow()"
            class="create-button"
          >
            <mat-icon>add</mat-icon> Créer un Événement
          </button>
        </div>

        <div *ngIf="showCreateRow" class="create-row">
          <mat-card class="create-card">
            <mat-card-content>
              <div class="form-grid">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Nom de l'événement</mat-label>
                  <input matInput [(ngModel)]="newEvenement.nomEvenement" required />
                  <mat-error *ngIf="!newEvenement.nomEvenement">Le nom est requis</mat-error>
                </mat-form-field>
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Description</mat-label>
                  <textarea matInput [(ngModel)]="newEvenement.description" required></textarea>
                  <mat-error *ngIf="!newEvenement.description">La description est requise</mat-error>
                </mat-form-field>
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Type d'événement</mat-label>
                  <mat-select [(ngModel)]="newEvenement.typeEvenement">
                    <mat-option value="Heureux">Heureux</mat-option>
                    <mat-option value="Triste">Triste</mat-option>
                    <mat-option value="Autre">Autre</mat-option>
                  </mat-select>
                  <mat-error *ngIf="!newEvenement.typeEvenement">Le type est requis</mat-error>
                </mat-form-field>
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Membre lié</mat-label>
                  <mat-select [(ngModel)]="newEvenement.idMembreLie">
                    <mat-option [value]="null">Aucun</mat-option>
                    <mat-option *ngFor="let membre of membres" [value]="membre.id">
                      {{ membre.prenom }} {{ membre.nom }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-checkbox class="form-field" [(ngModel)]="newEvenement.estContributionOuverte">
                  Contributions ouvertes
                </mat-checkbox>
                <div class="action-buttons">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="saveEvenement()"
                    [disabled]="!isCreateFormValid()"
                    class="save-button"
                  >
                    Enregistrer
                  </button>
                  <button
                    mat-raised-button
                    color="warn"
                    (click)="cancelCreate()"
                    class="cancel-button"
                  >
                    Annuler
                  </button>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSource" matSort class="data-table">
            <ng-container matColumnDef="nomEvenement">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Nom de l'événement</th>
              <td mat-cell *matCellDef="let evenement" data-label="Nom de l'événement">
                {{ evenement.nomEvenement }}
              </td>
            </ng-container>

            <ng-container matColumnDef="typeEvenement">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
              <td mat-cell *matCellDef="let evenement" data-label="Type">
                {{ evenement.typeEvenement }}
              </td>
            </ng-container>

            <ng-container matColumnDef="dateCreation">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Date de création</th>
              <td mat-cell *matCellDef="let evenement" data-label="Date de création">
                {{ evenement.dateCreation | date: 'dd/MM/yyyy' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="estContributionOuverte">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Contributions ouvertes</th>
              <td mat-cell *matCellDef="let evenement" data-label="Contributions ouvertes">
                <mat-icon [color]="evenement.estContributionOuverte ? 'primary' : 'warn'">
                  {{ evenement.estContributionOuverte ? 'check_circle' : 'cancel' }}
                </mat-icon>
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let evenement" data-label="Actions" class="col-actions">
                <div class="action-buttons-horizontal">
                  <button
                    mat-icon-button
                    color="accent"
                    (click)="viewContributions(evenement.id!)"
                    title="Voir les contributions"
                  >
                    <mat-icon>group</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="openDeleteDialog(evenement.idEvenement!)"
                    title="Supprimer"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="header-row"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns" class="table-row"></tr>
          </table>
        </div>
        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons class="paginator"></mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>