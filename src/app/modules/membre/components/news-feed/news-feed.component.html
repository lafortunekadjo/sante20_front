<div class="feed-container">
  <h1 class="page-title">Fil d'Actualité</h1>
  <mat-card class="feed-card">
    <mat-card-content>
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p class="loading-text">Chargement des actualités...</p>
      </div>
      <div *ngIf="!isLoading" class="feed-wrapper">
        <!-- Section Événements en Cours -->
        <mat-expansion-panel class="feed-section">
          <mat-expansion-panel-header>
            <mat-panel-title>Événements en Cours</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="feed-list">
            <mat-card *ngFor="let event of currentEvents" class="feed-item event-item">
              <mat-card-header>
                <mat-card-title>{{ event.nomEvenement }}</mat-card-title>
                <mat-card-subtitle>{{ event.typeEvenement }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>{{ event.description }}</p>
                <p *ngIf="event.estContributionOuverte">Contributions ouvertes jusqu'au {{ event.dateCreation | date:'dd/MM/yyyy' }}</p>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary">Voir Détails</button>
              </mat-card-actions>
            </mat-card>
            <p *ngIf="currentEvents.length === 0" class="no-data">Aucun événement en cours</p>
          </div>
        </mat-expansion-panel>

        <!-- Section Derniers Matchs -->
        <mat-expansion-panel class="feed-section">
          <mat-expansion-panel-header>
            <mat-panel-title>Derniers Matchs</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="feed-list">
            <mat-card *ngFor="let match of recentMatches" class="feed-item match-item">
              <mat-card-header>
                <mat-card-title>{{ match.adversaire }} ({{ match.typeMatch }})</mat-card-title>
                <mat-card-subtitle>{{ match.dateMatch | date:'dd/MM/yyyy' }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>Score: {{ getScore(match) }}</p>
                <p>Buteurs: {{ getButeurs(match) }}</p>
                <p>Passeurs: {{ getPasseurs(match) }}</p>
                <p>Homme du Match: {{ getHommeDuMatch(match) }}</p>
               <div class="media-gallery" *ngIf="match?.mediaUrls && match.mediaUrls.length > 0">
                <ng-container *ngFor="let mediaUrl of match.mediaUrls">
                  <ng-container *ngIf="mediaBlobUrls[apiBaseUrl + mediaUrl]">
                    <img *ngIf="mediaBlobUrls[apiBaseUrl + mediaUrl].type.startsWith('image')" [src]="mediaBlobUrls[apiBaseUrl + mediaUrl].url" alt="Media du match" class="media-item" (click)="openMediaPreview(match, mediaUrl)" />
                    <video *ngIf="mediaBlobUrls[apiBaseUrl + mediaUrl].type.startsWith('video')" [src]="mediaBlobUrls[apiBaseUrl + mediaUrl].url" controls class="media-item" (click)="openMediaPreview(match, mediaUrl)"></video>
                    <a *ngIf="mediaBlobUrls[apiBaseUrl + mediaUrl].type === 'application/pdf'" [href]="mediaBlobUrls[apiBaseUrl + mediaUrl].url" target="_blank" class="media-item">Voir PDF</a>
                    <div *ngIf="!mediaBlobUrls[apiBaseUrl + mediaUrl].type.startsWith('image') && !mediaBlobUrls[apiBaseUrl + mediaUrl].type.startsWith('video') && mediaBlobUrls[apiBaseUrl + mediaUrl].type !== 'application/pdf'" class="media-placeholder">Type non pris en charge</div>
                  </ng-container>
                  <div *ngIf="!mediaBlobUrls[apiBaseUrl + mediaUrl]" class="media-placeholder">Chargement...</div>
                </ng-container>
              </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary" (click)="downloadMedia(match)">Télécharger Médias</button>
                <button mat-button color="primary">Voir Présence</button>
              </mat-card-actions>
            </mat-card>
            <p *ngIf="recentMatches.length === 0" class="no-data">Aucun match récent</p>
          </div>
        </mat-expansion-panel>

        <!-- Section Contributions en Cours -->
        <mat-expansion-panel class="feed-section">
          <mat-expansion-panel-header>
            <mat-panel-title>Contributions en Cours</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="feed-list">
            <mat-card *ngFor="let contrib of ongoingContributions" class="feed-item contribution-item">
              <mat-card-header>
                <mat-card-title>{{ contrib.contribution.titre }}</mat-card-title>
                <mat-card-subtitle>Montant Collecté: {{ contrib.contribution.montantCollecteActuel }} / {{ contrib.contribution.montantCible }} FCFA</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p *ngFor="let indiv of contrib.individuelles">Contributeur: {{ getMembreName(indiv.idMembre) }} - {{ indiv.montant }} FCFA</p>
                <p>Délai: {{ contrib.contribution.delaiContribution | date:'dd/MM/yyyy' }}</p>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary">Contribuer</button>
              </mat-card-actions>
            </mat-card>
            <p *ngIf="ongoingContributions.length === 0" class="no-data">Aucune contribution en cours</p>
          </div>
        </mat-expansion-panel>

        <!-- Section Anniversaires à Venir -->
        <mat-expansion-panel class="feed-section">
          <mat-expansion-panel-header>
            <mat-panel-title>Anniversaires à Venir</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="feed-list">
            <mat-card *ngFor="let birthday of upcomingBirthdays" class="feed-item birthday-item">
              <mat-card-header>
                <mat-card-title>Anniversaire de {{ birthday.membre.prenom }} {{ birthday.membre.nom }}</mat-card-title>
                <mat-card-subtitle>{{ birthday.date | date:'dd/MM/yyyy' }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>Préparez-vous pour la célébration !</p>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary">Envoyer un Message</button>
              </mat-card-actions>
            </mat-card>
            <p *ngIf="upcomingBirthdays.length === 0" class="no-data">Aucun anniversaire à venir</p>
          </div>
        </mat-expansion-panel>

        <!-- Section Statistiques du Groupe -->
        <mat-expansion-panel class="feed-section">
          <mat-expansion-panel-header>
            <mat-panel-title>Statistiques du Groupe</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="feed-list">
            <mat-card class="feed-item stats-item">
              <mat-card-header>
                <mat-card-title>Top Buteurs</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <ul>
                  <li *ngFor="let scorer of topScorers">{{ scorer.membre.prenom }} {{ scorer.membre.nom }} - {{ scorer.buts }} buts</li>
                </ul>
              </mat-card-content>
            </mat-card>
            <mat-card class="feed-item stats-item">
              <mat-card-title>Top Passeurs</mat-card-title>
              <mat-card-content>
                <ul>
                  <li *ngFor="let passer of topPassers">{{ passer.membre.prenom }} {{ passer.membre.nom }} - {{ passer.passes }} passes</li>
                </ul>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-expansion-panel>

        <!-- Section Annonces du Groupe -->
        <mat-expansion-panel class="feed-section">
          <mat-expansion-panel-header>
            <mat-panel-title>Annonces du Groupe</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="feed-list">
            <mat-card *ngFor="let announcement of groupAnnouncements" class="feed-item announcement-item">
              <mat-card-header>
                <mat-card-title>{{ announcement.title }}</mat-card-title>
                <mat-card-subtitle>{{ announcement.date | date:'dd/MM/yyyy' }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>{{ announcement.content }}</p>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary">Lire Plus</button>
              </mat-card-actions>
            </mat-card>
            <p *ngIf="groupAnnouncements.length === 0" class="no-data">Aucune annonce</p>
          </div>
        </mat-expansion-panel>
      </div>
    </mat-card-content>
  </mat-card>
</div>